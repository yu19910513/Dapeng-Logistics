<!DOCTYPE html>
<html lang="en">
<head>
    <title>Dapeng Logistics</title>
    <link rel="icon" type="image/png type" sizes="32x32" href="/media/logo.jpeg">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/reset.css">
{{!-- uikit attachments --}}
    <link rel="stylesheet" href="/css/uikit/uikit.min.css"/>
    <script src="/javascript/uikit/uikit.min.js"></script>
    <script src="/javascript/uikit/uikit-icons.min.js"></script>
{{!-- bootstrap --}}
    <script src="/javascript/bootstrap/bootstrap.bundle.min.js"></script>
    <link href="/css/bootstrap/bootstrap.min.css" rel="stylesheet">
{{!-- jquery --}}
    <script src="/javascript/jquery.js"></script>
    <link rel="stylesheet" href="/css/login.css">
    <link rel="stylesheet" href="/css/print_setting.css">
</head>
<body>
{{#if loggedIn}}
<nav class="navbar navbar-expand-lg navbar-light bg-light p-3" id="nav_bar">
    <div class="container">
    <a class="navbar-brand" href="/" uk-tooltip="å›åˆ°ä¸»é¡µ"><img src="/media/panpan-0-1.png" width="120" height="auto" class="d-inline-block align-top" alt="logo"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#dapengitems" aria-controls="dapengitems" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="dapengitems">
        <ul class="navbar-nav mr-auto">
            {{#if admin}}
            <li class="nav-item"><a class="nav-link rounded-sm text-center text-dark" href="/admin_move_main" uk-tooltip="å‡ºè´§é€šçŸ¥">Ship-Out</a></li>
            <li class="nav-item"><a class="nav-link rounded-sm text-center text-dark" href="/admin_receiving_main" uk-tooltip="æµ·å¤–è´§å“æ¥æ”¶">ReceptionğŸ‡¨ğŸ‡³</a></li>
            <li class="nav-item"><a class="nav-link rounded-sm text-center text-dark" href="/amazon_receiving" uk-tooltip="äºšé©¬é€Šè´§å“æ¥æ”¶">ReceptionğŸ‡ºğŸ‡¸</a></li>
            <li class="nav-item"><a class="nav-link rounded-sm text-center text-dark" href="/box_location" onclick="resetLocalStorage()" uk-tooltip="è½½å…¥è´§æ¶">Allocation</a></li>
            <li class="nav-item"><a class="nav-link rounded-sm text-center text-dark" href="/delete_queue_admin" uk-tooltip="è´§ç‰©åˆ é™¤è¯·æ±‚">Deletion</a></li>
            <li class="nav-item"><a class="nav-link logout rounded-sm text-center text-dark" style="background-color: #E0EEEE;">Log Out<span uk-icon="icon: sign-out"></span></a></li>
            {{else}}
            <li class="create_order nav-item" onclick="accountList()"><a class="nav-link rounded-sm text-center text-dark" href="#createneworder" uk-toggle>æ–°è®¢å•</a></li>
            {{!-- uk-toogle --}}
                <div id="createneworder" uk-modal>
                    <div class="uk-modal-dialog">
                        <button class="uk-modal-close-default" type="button" uk-close></button>
                        <div class="uk-modal-header uk-background-muted uk-text-center">
                            <h4 class="lead">å¸å·<u class="text-primary">å­ç”¨æˆ·</u>é€‰æ‹©</h4>
                        </div>
                        <p class="uk-margin-medium-left uk-margin-medium-right uk-margin-medium-top uk-margin-medium-bottom">Before creating a new shipment, please select an existed account to where the new order will be assigned. If you would like to create a new account, select "Create New Account" and continue. <br><small>åˆ›é€ æ–°è®¢å•å‰ï¼Œè¯·é€‰æ‹©ä¸€ä¸ªå·²æ³¨å†Œå­ç”¨æˆ·ï¼Œå¦‚æ¬²åˆ›ç«‹æ–°å­ç”¨æˆ·åï¼Œé€‰æ‹©â€œcreate new accountâ€ç„¶åâ€œç¡®è®¤â€ã€‚</small></p>
                        <form class="uk-form-horizontal uk-margin-small uk-margin-small-left">
                            <div class="uk-margin">
                                <label class="uk-form-label" for="form-horizontal-select"><span uk-icon="icon: user"></span>USER: {{name}}</label>
                                <div class="uk-form-controls uk-form-width-medium">
                                    <select class="uk-select accountList" id="accountList">
                                        <option>Create New Account</option>
                                    </select>
                                </div>
                            </div>
                            <div class="uk-modal-footer uk-text-right">
                                <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
                                <a class="uk-button uk-button-primary" id="account_selection" uk-icon="icon:  arrow-right" href="/neworder">Continue(ç¡®è®¤)</a>
                            </div>
                        </form>
                    </div>
                </div>
            <li class="nav-item"><a class="nav-link rounded-sm text-center text-dark" href="/client_label">æ€»æŒ‚å•</a></li>
            <li class="nav-item"><a class="nav-link rounded-sm text-center text-dark" href="/master" >æ€»åº“å­˜</a></li>
            <li class="nav-item"><a class="nav-link rounded-sm text-center text-dark" href="/request">æ€»å‡ºè´§</a></li>
            <li class="nav-item"><a class="nav-link rounded-sm text-center text-dark" href="/dq_chinabox" uk-tooltip="delete queue">åˆ é™¤è¯·æ±‚</a></li>
            <li class="nav-item"><a class="nav-link logout rounded-sm text-center text-dark" style="background-color: #E0EEEE">ç™»å‡º<span uk-icon="icon: sign-out"></span></a></li>
            {{/if}}
        </ul>
    </div>
    </div>
</nav>
{{/if}}
<small id="session_timer"></small>
<main>
    {{{body}}}
</main>
<footer class="text-center text-lg-start mt-3">
{{!-- <hr class="mt-3"> --}}
  <!-- Copyright -->
  <div class="text-center p-3" style="background-color: rgb(254, 254, 254);">
    Â© 2022 Copyright:
    <a class="text-dark" href="http://www.dapeng-wuliu.cn/">Dapeng-wuliu.cn</a>
  </div>
  <!-- Copyright -->
</footer>
{{#if loggedIn}}
<script src="javascript/main.js"></script>
<script src="javascript/logout.js"></script>
<script>
    console.log('The timer is initiated for 30 minutes.');
    $(document).ready(function() {
        checkActivity(1800000, 60000, 0); // timeout = 30 minutes, interval = 1 minute.
    });

    function checkActivity(timeout, interval, elapsed) {
        if (elapsed < timeout) {
            const lastMinute = (timeout - elapsed);
            elapsed += interval;
            setTimeout(function() {
                checkActivity(timeout, interval, elapsed);
            }, interval);
            console.log(lastMinute/interval);
            if(lastMinute == interval) {
                if(confirm('é¡µé¢å°†åœ¨50ç§’åè‡ªåŠ¨è·³è½¬ï¼Œå¦‚æœä»åœ¨ä½¿ç”¨æ­¤é¡µé¢ï¼Œè¯·æŒ‰okã€‚Still using the page? If so, please press OK. Otherwise, the session will expire in 50 seconds.')) {
                    const promisesForAction = [];
                    promisesForAction.push(serverGoAround());
                    Promise.all(promisesForAction).then(() => {
                        timeout = 1800000 - interval;
                        elapsed = 0;
                        console.log('The timer is reset back to 30 minutes.');
                        console.log((timeout + interval)/interval);
                    }).catch((e) => {console.log(e)})
                } else {
                    document.getElementById('session_timer').innerHTML = `<div class='text-danger text-center'>é¡µé¢å°†åœ¨50ç§’ä¹‹åè·³è½¬ã€‚<br>The session expires in 50 seconds.</div>`
                }
            }
        } else {
        // Redirect to "session expired" page. --}}
           window.location.reload();
        }
    };
    async function serverGoAround() {
        const response = await fetch(`/api/user/serverGoAround`, {
        method: 'GET'
        }).then(function (response) {
        return response.json();
        })
    };
</script>
{{/if}}
</body>
</html>
